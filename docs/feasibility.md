# 可行性报告

## 项目介绍

现有的热门的分布式文件系统，如`Juicefs`，有着许多性能与用户体验上的问题。特别在目前火热的深度学习等需要昂贵硬件资源的领域，一个大容量，高读写速度的分布式文件系统显得尤为重要。在本次项目中，我们决定选取DisGraFs这一项目，从不同方面针对现有的分布式文件系统的瓶颈与用户体验进行了优化与改造。

## 理论依据

* 文件所具有的标签提供的基于Cache逻辑局部性主动缓存的可能性

  ——基于文件的打标信息，可以实现对特定标签的文件的主动缓存

* 网页预览可以有效减少文件系统的I/O开销

  ——使用户通过网页预览的形式浏览文件，而非将文件下载到本地，减少I/O开销

* 容器化部署和监控组件可以减轻运维人员的负担

  ——容器化简化部署流程，监控组件方便管理平台



## 技术依据

### 分布式文件系统：Juicefs

JuiceFS 是一款面向云环境设计的高性能共享文件系统，在 AGPL v3.0 开源协议下发布。提供完备的 [POSIX](https://en.wikipedia.org/wiki/POSIX) 兼容性，可将海量低价的云存储作为本地磁盘使用，亦可同时被多台主机同时挂载读写。

使用 JuiceFS 存储数据，数据本身会被持久化在对象存储（例如，Amazon S3），而数据所对应的元数据可以根据场景需要被持久化在 Redis、MySQL、SQLite 等多种数据库中。

JuiceFS 提供了丰富的 API，可以在不修改代码的前提下无缝对接已投入生产的大数据、机器学习、人工智能等应用平台，为其提供海量、弹性、低价的高性能存储。

![](../src/imgs/4.jpg)

### 浏览器与本地脚本交互：ActiveX

ActiveX是[Microsoft](https://baike.baidu.com/item/Microsoft/125917)对于一系列策略性[面向对象程序](https://baike.baidu.com/item/面向对象程序/8359543)技术和工具的称呼，其中主要的技术是[组件对象模型](https://baike.baidu.com/item/组件对象模型/3351546)（COM）。在有目录和其它支持的网络中，COM变成了分布式COM（DCOM)。

ActiveX 控件是用于互联网的很小的程序，有时称为[插件程序](https://baike.baidu.com/item/插件程序/5704926)*。*它们会允许播放动画，或帮助执行任务，如在 Microsoft Update 安装安全更新，因此可以增强您的浏览体验。

在创建包括ActiveX程序时，主要的工作就是组件，一个可以自足的在ActiveX网络（Windows，Mac，Linux）中任意运行的程序。这个组件就是ActiveX控件。ActiveX是Microsoft为抗衡Sun Microsystems的JAVA技术而提出的，此控件的功能和java applet功能类似。

### 视频预览雪碧图生成：ffmpeg

FFmpeg是一套可以用来记录、转换数字音频、视频，并能将其转化为流的开源计算机程序。采用LGPL或[GPL](https://baike.baidu.com/item/GPL/2357903)许可证。它提供了录制、转换以及流化音视频的完整解决方案。它包含了非常先进的音频/视频编解码库libavcodec，为了保证高可移植性和编解码质量，libavcodec里很多code都是从头开发的。

**精灵图**（英语：Sprite），又被称为**拼合图**。在[计算机图形学](https://zh.wikipedia.org/wiki/计算机图形学)中，当一张[二维](https://zh.wikipedia.org/wiki/二維)[图像](https://zh.wikipedia.org/wiki/图像)集成进场景中，成为整个显示图像的一部分时，这张图就称为**精灵图**。

因为常见碳酸饮料[雪碧](https://zh.wikipedia.org/wiki/雪碧)的英文名称也是“Sprite”，也有人会使用**雪碧图**的非正式译名。

### 监控：Prometheus Server和Grafana

Prometheus：Prometheus是一个开源的系统监控和警报工具包。自2012年启动以来，许多公司和组织都采用了Prometheus，该项目拥有非常活跃的开发人员和用户社区。它现在是一个独立的开源项目，独立于任何公司进行维护。Prometheus于2016年加入云原生计算基金会，成为继Kubernetes之后的第二个托管项目。

它具有下列特性：

- 一个多维数据模型，包含由指标名称和键/值对（Tag）标识的时间序列数据
- PromQL是一种灵活的查询语音，用于查询并利用这些维度数据
- 不依赖分布式存储，单个服务器节点是自治的
- 时间序列收集是通过HTTP上的pull模型进行的（支持Pull）
- 推送时间序列是通过一个中间网关来支持的（也支持Push）
- 目标是通过服务发现或静态配置发现的
- 多种模式的图形和仪表盘支持

总结一下，就是多维数据模型、PromQL查询语言、节点自治、HTTP主动拉取或者网关主动推送的方式获取时间序列数据、自动发现目标、多种仪表盘支持。

Grafana:

Grafana是一个开源的，拥有丰富dashboard和图表编辑的指标分析平台，和Kibana不同的是Grafana专注于时序类图表分析，而且支持多种数据源，如Graphite、InfluxDB、Elasticsearch、Mysql、K8s、Zabbix等。

## 技术路线

### 容器化部署

Kubernetes：一个用于大规模运行分布式应用和服务的开源容器编排平台。本项目将对服务器端的部署作出容器化，把应用及其依赖项都将打包成一个可以复用的镜像并与其他进程环境隔离。

### Juicefs的缓存实现

JuiceFS预热缓存功能：

•主动缓存手段

•保证缓存的数据一致性

•尽可能不更改源代码，而是用脚本自定义

需要考虑：

•元数据缓存or数据缓存？

•相关文件太多怎么办？

•视频这种修改较少、体量较大的有更好的方式吗？

### 预览功能的实现

•将网页端口与JuiceFS本地cache关联

•底层是打开文件，效果是Hover（悬停展示），需要调整网页端的适配

